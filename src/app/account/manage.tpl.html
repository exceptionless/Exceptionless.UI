<div class="hbox hbox-auto-xs hbox-auto-sm">
  <div class="col" refresh-on="UserChanged ProjectChanged" refresh-action="vm.get(data)" refresh-debounce="1000">
    <div class="wrapper-md">
      <div class="panel panel-default">
        <div class="panel-heading"><i class="fa fa-user"></i> My Account</div>
        <div class="panel-body m-b-n">
          <tabset class="tab-container">
            <tab heading="General">
              <form name="fullNameForm" role="form" class="form-validation" autocomplete="on">
                <div class="form-group">
                  <img gravatar-src="vm.user.email_address" gravatar-size="100" alt="{{vm.user.full_name}}" class="avatar">
                  <div>
                    <small>
                      Your avatar is generated by requesting a <a href="https://gravatar.com" target="_blank">Gravatar image</a> with the email address below.
                    </small>
                  </div>
                </div>

                <div class="form-group">
                  <label for="name">Full Name</label>
                  <input id="name" name="name" type="text" class="form-control" x-autocompletetype="full-name" autocapitalize="words" autocorrect="off" spellcheck="false"
                         placeholder="Your first and last name"
                         ng-model="vm.user.full_name"
                         ng-model-options="{ debounce: 500 }"
                         ng-change="vm.saveUser(fullNameForm.$valid)"
                         ng-required="true"
                         autofocus />

                  <div class="error" ng-messages="fullNameForm.name.$error" ng-if="fullNameForm.$submitted || fullNameForm.name.$touched">
                    <small ng-message="required">Full Name is required.</small>
                  </div>
                </div>
              </form>

              <form name="vm.emailAddressForm" role="form" class="form-validation" autocomplete="on">
                <div class="form-group">
                  <label for="email">Email Address</label>
                  <div ng-class="{'input-group': vm.emailAddressForm.$pending }">
                    <input id="email" name="email" type="email" class="form-control" x-autocompletetype="email" autocorrect="off" spellcheck="false"
                           placeholder="Email Address"
                           ng-model="vm.user.email_address"
                           ng-model-options="{ debounce: 500 }"
                           ng-change="vm.saveEmailAddress()"
                           email-address-available-validator
                           required/>

                    <span class="input-group-addon" ng-if="vm.emailAddressForm.$pending">
                      <i class="fa fa-fw fa-spinner fa-spin"></i>
                    </span>
                  </div>

                  <div class="error" ng-messages="vm.emailAddressForm.email.$error" ng-if="vm.emailAddressForm.$submitted || vm.emailAddressForm.email.$touched">
                    <small ng-message="required">Email Address is required.</small>
                    <small ng-message="email">Email Address is required.</small>
                    <small ng-message="unique">A user already exists with this email address.</small>
                  </div>

                  <p ng-if="!vm.user.is_email_address_verified" class="help-block">
                    Email not verified. <a ng-click="vm.resendVerificationEmail()">Resend</a> verification email.
                  </p>
                </div>
              </form>
            </tab>
            <tab heading="Notifications" active="vm.tabNotificationsActive">
              <form role="form" class="form-validation">
                <div class="alert in fade alert-danger" ng-if="!vm.user.is_email_address_verified || !vm.user.email_notifications_enabled">
                  Email notifications are currently disabled. <span ng-if="!vm.user.is_email_address_verified">To enable email notifications you must first verify your email address. <a ng-click="vm.resendVerificationEmail()">Resend</a> verification email.</span>
                </div>
                <div class="checkbox">
                  <label class="i-checks">
                    <input type="checkbox"
                           ng-model="vm.user.email_notifications_enabled"
                           ng-model-options="{ debounce: 500 }"
                           ng-change="vm.saveEnableEmailNotification()">
                    <i></i>
                    Enable email notifications
                  </label>
                </div>

                <div ng-if="vm.hasProjects()">
                  <hr/>

                  <p>Choose how often you want to receive notifications for event occurrences in this project.</p>

                  <select class="form-control"
                          ng-model="vm.currentProject"
                          ng-change="vm.getEmailNotificationSettings()"
                          ng-disabled="!vm.hasEmailNotifications()"
                          ng-options="project.name group by project.organization_name for project in vm.projects"></select>

                  <div class="checkbox">
                    <label class="i-checks">
                      <input type="checkbox"
                             ng-model="vm.emailNotificationSettings.send_daily_summary"
                             ng-model-options="{ debounce: 500 }"
                             ng-change="vm.saveEmailNotificationSettings()"
                             ng-disabled="!vm.hasEmailNotifications()">
                      <i></i>
                      Send daily project summary
                    </label>
                  </div>


                  <hr ng-if="!vm.hasPremiumFeatures()"/>
                  <div class="alert in fade alert-success" ng-if="!vm.hasPremiumFeatures()">
                    <a ng-click="vm.showChangePlanDialog()">Upgrade now</a> to enable occurrence level notifications!
                  </div>

                  <div class="checkbox">
                    <label class="i-checks">
                      <input type="checkbox"
                             ng-model="vm.emailNotificationSettings.report_new_errors"
                             ng-model-options="{ debounce: 500 }"
                             ng-change="vm.saveEmailNotificationSettings()"
                             ng-disabled="!vm.hasPremiumEmailNotifications()">
                      <i></i>
                      Notify me on new errors
                    </label>
                  </div>

                  <div class="checkbox">
                    <label class="i-checks">
                      <input type="checkbox"
                             ng-model="vm.emailNotificationSettings.report_critical_errors"
                             ng-model-options="{ debounce: 500 }"
                             ng-change="vm.saveEmailNotificationSettings()"
                             ng-disabled="!vm.hasPremiumEmailNotifications()">
                      <i></i>
                      Notify me on critical errors
                    </label>
                  </div>

                  <div class="checkbox">
                    <label class="i-checks">
                      <input type="checkbox"
                             ng-model="vm.emailNotificationSettings.report_event_regressions"
                             ng-model-options="{ debounce: 500 }"
                             ng-change="vm.saveEmailNotificationSettings()"
                             ng-disabled="!vm.hasPremiumEmailNotifications()">
                      <i></i>
                      Notify me on error regressions
                    </label>
                  </div>

                  <div class="checkbox">
                    <label class="i-checks">
                      <input type="checkbox"
                             ng-model="vm.emailNotificationSettings.report_new_events"
                             ng-model-options="{ debounce: 500 }"
                             ng-change="vm.saveEmailNotificationSettings()"
                             ng-disabled="!vm.hasPremiumEmailNotifications()">
                      <i></i>
                      Notify me on new events
                    </label>
                  </div>

                  <div class="checkbox">
                    <label class="i-checks">
                      <input type="checkbox"
                             ng-model="vm.emailNotificationSettings.report_critical_events"
                             ng-model-options="{ debounce: 500 }"
                             ng-change="vm.saveEmailNotificationSettings()"
                             ng-disabled="!vm.hasPremiumEmailNotifications()">
                      <i></i>
                      Notify me on critical events
                    </label>
                  </div>
                </div>
              </form>
            </tab>
            <tab heading="Password" active="vm.tabPasswordActive">
              <form name="vm.passwordForm" role="form" class="form-validation">
                <div class="form-group" ng-if="vm.hasLocalAccount()">
                  <label for="current">Current Password</label>
                  <input id="current" name="current" type="password" class="form-control" ng-model="vm.password.current_password" required />

                  <div class="error" ng-messages="vm.passwordForm.current.$error" ng-if="vm.passwordForm.$submitted || vm.passwordForm.current.$touched">
                    <small ng-message="required">Current Password is required.</small>
                  </div>
                </div>

                <div class="form-group">
                  <label for="newPassword">New Password</label>
                  <input id="newPassword" name="newPassword" type="password" class="form-control" ng-model="vm.password.password" ng-minlength="6" ng-maxlength="100" required />

                  <div class="error" ng-messages="vm.passwordForm.newPassword.$error" ng-if="vm.passwordForm.$submitted || vm.passwordForm.newPassword.$touched">
                    <small ng-message="required">New Password is required.</small>
                    <small ng-message="minlength">New Password must be at least 6 characters long.</small>
                    <small ng-message="maxlength">New Password must be less than 101 characters long.</small>
                  </div>
                </div>

                <div class="form-group">
                  <label for="confirmPassword">Confirm password</label>
                  <input id="confirmPassword" name="confirmPassword" type="password" class="form-control"
                         ng-model="vm.password.confirm_password"
                         match="vm.password.password"
                         ng-minlength="6"
                         ng-maxlength="100"
                         ng-required="true" />

                  <div class="error" ng-messages="vm.passwordForm.confirmPassword.$error" ng-if="vm.passwordForm.$submitted || vm.passwordForm.confirmPassword.$touched">
                    <small ng-message="match">New Password and Confirmation Password fields do not match.</small>
                    <small ng-message="required">Confirm Password is required.</small>
                    <small ng-message="minlength">Confirm Password must be at least 6 characters long.</small>
                    <small ng-message="maxlength">Confirm Password must be less than 101 characters long.</small>
                  </div>
                </div>

                <button type="submit" role="button" class="btn btn-primary" promise-button="vm.changePassword(vm.passwordForm.$valid)" promise-button-busy-text="{{vm.hasLocalAccount() ? 'Changing Password' : 'Setting Password'}}">{{vm.hasLocalAccount() ? 'Change Password' : 'Set Password'}}</button>
              </form>
            </tab>
            <tab heading="External Logins" active="vm.tabExternalActive">
              <h4>Add an external login</h4>

              <div>
                <button type="button" role="button" ng-click="vm.authenticate('live')" class="btn btn-large image-button icon-login-microsoft" title="Log in using your Microsoft account"></button>
                <button type="button" role="button" ng-click="vm.authenticate('google')" class="btn btn-large image-button icon-login-google" title="Log in using your Google account"></button>
                <button type="button" role="button" ng-click="vm.authenticate('facebook')" class="btn btn-large image-button icon-login-facebook" title="Log in using your Facebook account"></button>
                <button type="button" role="button" ng-click="vm.authenticate('github')" class="btn btn-large image-button icon-login-github" title="Log in using your GitHub account"></button>
              </div>

              <h4>Existing external logins</h4>
              <div class="table-responsive">
                <table class="table table-striped table-bordered table-fixed b-t">
                  <thead>
                    <tr>
                      <th>Name</th>
                      <th class="action">Actions</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr ng-repeat="account in vm.user.o_auth_accounts" ng-if="vm.hasOAuthAccounts()">
                      <td>{{::account.provider}} ({{::account.username || account.provider_user_id}})</td>
                      <td>
                        <button type="button" role="button" class="btn btn-sm" title="Remove"
                                ng-disabled="!vm.canRemoveOAuthAccount()"
                                ng-click="vm.unlink(account)">
                          <i class="fa fa-times"></i>
                        </button>
                      </td>
                    </tr>
                    <tr ng-if="!vm.hasOAuthAccounts()">
                      <td colspan="2">
                        <strong>No external logins were found.</strong>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </tab>
          </tabset>
        </div>
        <footer class="panel-footer">
          <div class="pull-right">
            <div ng-if="!vm.currentProject.id">
              <a ui-sref="app.dashboard" class="btn btn-default" role="button">Go To Dashboard</a>
            </div>
            <div ng-if="vm.currentProject.id">
              <a ui-sref="app.project-dashboard({ projectId: vm.currentProject.id })" class="btn btn-default" role="button">Go To Dashboard</a>
            </div>
          </div>
          <div class="clearfix" />
        </footer>
      </div>
    </div>
  </div>
</div>
